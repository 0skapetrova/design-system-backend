# Политики данных (data-policies)

## Projects

### Уникальность имени
Имя проекта уникально только среди активных проектов пользователя.

Реализуется частичным уникальным индексом:

- (user_id, name) WHERE deleted_at IS NULL

Архивные проекты не блокируют создание нового проекта с тем же именем.

### Soft-delete
Поле deleted_at заполняется.  
Данные остаются в базе для истории и восстановления.

---

## Clients

### Глобальная уникальность телефона
Телефон клиента уникален глобально (и для активных, и для архивных).

Если телефон существует в архиве — показывается подсказка:

- "Клиент найден в архиве, восстановить?"

### Нормализация телефона
Перед записью телефон приводится к формату E.164.  
Это обеспечивает корректную проверку уникальности.

### Восстановление клиента
Восстановление — это UPDATE:

- очищается deleted_at
- клиент снова активен
- связи и история остаются

### RLS (Row-Level Security)
Операции чтения, создания и восстановления доступны только владельцу:

- политики определяются через USING и WITH CHECK
- другие пользователи не видят и не восстанавливают чужих клиентов
